# This file contains pin mappings for the stock 2020 Creality Ender 5
# Pro with the 32-bit Creality 4.2.2 board. To use this config, during
# "make menuconfig" select the STM32F103 with a "28KiB bootloader" and
# with "Use USB for communication" disabled.

# If you prefer a direct serial connection, in "make menuconfig"
# select "Enable extra low-level configuration options" and select the
# USART3 serial port, which is broken out on the 10 pin IDC cable used
# for the LCD module as follows:
# 3: Tx, 4: Rx, 9: GND, 10: VCC

# Flash this firmware by copying "out/klipper.bin" to a SD card and
# turning on the printer with the card inserted. The firmware
# filename must end in ".bin" and must not match the last filename
# that was flashed.

# See docs/Config_Reference.md for a description of parameters.
[include mainsail.cfg]
[include ebbcan.cfg]
[include Orbiter2_SmartSensor.cfg]
[include macro.cfg]
[include eddy.cfg]

[multi_pin my_fans]
pins: EBBCan: PA1 , EBBCan: PA0

[stepper_x]
step_pin: PC2
dir_pin: PB9
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA5
position_endstop: 220
position_max: 220
position_min: 0
homing_speed: 50

[stepper_y]
step_pin: PB8
dir_pin: PB7
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA6
position_endstop: 200
position_max: 200
position_min:-30
homing_speed: 50

[stepper_z]
step_pin: PB6
dir_pin: PB5
enable_pin: !PC3
microsteps: 16
rotation_distance: 4
endstop_pin: probe:z_virtual_endstop
position_max: 250
#position_endstop: 0.0

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 4.637
nozzle_diameter: 0.600
filament_diameter: 1.750
heater_pin: EBBCan: PB13
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: EBBCan: PA3
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_temp: 0
max_temp: 300
sensor_type: MAX31865
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2

[heater_bed]
heater_pin: PA2
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
control: pid
pid_kp: 66.429
pid_ki: 1.197
pid_kd: 921.707
min_temp: 0
max_temp: 135

[fan]
pin: multi_pin: my_fans

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

[display]
lcd_type: st7920
cs_pin: PB12
sclk_pin: PB13
sid_pin: PB15
encoder_pins: ^PB14, ^PB10
click_pin: ^!PB2

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 37.814
#*# pid_ki = 10.084
#*# pid_kd = 35.451
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3235619.339,0.090000:3234720.828,0.130000:3233825.764,
#*# 	0.170000:3232930.934,0.210000:3232067.347,0.250000:3231206.501,
#*# 	0.290000:3230391.309,0.330000:3229562.336,0.370000:3228717.490,
#*# 	0.410000:3227919.593,0.450000:3227160.137,0.490000:3226382.352,
#*# 	0.530000:3225628.767,0.570000:3224885.224,0.610000:3224195.743,
#*# 	0.650000:3223500.010,0.690000:3222822.398,0.730000:3222125.816,
#*# 	0.770000:3221475.356,0.810000:3220814.128,0.850000:3220198.553,
#*# 	0.890000:3219523.443,0.930000:3218929.033,0.970000:3218347.650,
#*# 	1.010000:3217744.841,1.050000:3217163.705,1.090000:3216591.757,
#*# 	1.130000:3216019.824,1.170000:3215431.455,1.210000:3214850.880,
#*# 	1.250000:3214286.361,1.290000:3213723.637,1.330000:3213202.623,
#*# 	1.370000:3212676.390,1.410000:3212160.759,1.450000:3211642.576,
#*# 	1.490000:3211160.693,1.530000:3210672.435,1.570000:3210206.541,
#*# 	1.610000:3209750.909,1.650000:3209304.541,1.690000:3208835.883,
#*# 	1.730000:3208409.659,1.770000:3208003.659,1.810000:3207574.200,
#*# 	1.850000:3207149.407,1.890000:3206735.188,1.930000:3206353.216,
#*# 	1.970000:3205941.251,2.010000:3205540.727,2.050000:3205178.652,
#*# 	2.090000:3204809.284,2.130000:3204438.541,2.170000:3204090.141,
#*# 	2.210000:3203743.032,2.250000:3203380.631,2.290000:3203029.308,
#*# 	2.330000:3202694.077,2.370000:3202360.321,2.410000:3202055.547,
#*# 	2.450000:3201742.907,2.490000:3201417.783,2.530000:3201117.082,
#*# 	2.570000:3200792.883,2.610000:3200520.283,2.650000:3200213.234,
#*# 	2.690000:3199902.265,2.730000:3199612.496,2.770000:3199312.091,
#*# 	2.810000:3199047.697,2.850000:3198784.199,2.890000:3198523.452,
#*# 	2.930000:3198257.416,2.970000:3198012.057,3.010000:3197734.156,
#*# 	3.050000:3197482.603,3.090000:3197237.264,3.130000:3196986.864,
#*# 	3.170000:3196746.701,3.210000:3196503.693,3.250000:3196262.311,
#*# 	3.290000:3196040.528,3.330000:3195811.460,3.370000:3195585.505,
#*# 	3.410000:3195361.401,3.450000:3195168.532,3.490000:3194931.408,
#*# 	3.530000:3194733.441,3.570000:3194517.331,3.610000:3194320.185,
#*# 	3.650000:3194114.901,3.690000:3193921.531,3.730000:3193732.211,
#*# 	3.770000:3193532.991,3.810000:3193348.144,3.850000:3193175.522,
#*# 	3.890000:3192989.016,3.930000:3192784.937,3.970000:3192637.037,
#*# 	4.010000:3192442.829,4.050000:3192272.081
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 33.591034
