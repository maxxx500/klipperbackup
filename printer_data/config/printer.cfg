# This file contains pin mappings for the stock 2020 Creality Ender 5
# Pro with the 32-bit Creality 4.2.2 board. To use this config, during
# "make menuconfig" select the STM32F103 with a "28KiB bootloader" and
# with "Use USB for communication" disabled.

# If you prefer a direct serial connection, in "make menuconfig"
# select "Enable extra low-level configuration options" and select the
# USART3 serial port, which is broken out on the 10 pin IDC cable used
# for the LCD module as follows:
# 3: Tx, 4: Rx, 9: GND, 10: VCC

# Flash this firmware by copying "out/klipper.bin" to a SD card and
# turning on the printer with the card inserted. The firmware
# filename must end in ".bin" and must not match the last filename
# that was flashed.

# See docs/Config_Reference.md for a description of parameters.
[include mainsail.cfg]
[include ebbcan.cfg]
[include Orbiter2_SmartSensor.cfg]
[include macro.cfg]
[include eddy.cfg]

[multi_pin my_fans]
pins: EBBCan: PA1 , EBBCan: PA0

[stepper_x]
step_pin: PC2
dir_pin: PB9
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA5
position_endstop: 220
position_max: 220
position_min: 0
homing_speed: 50

[stepper_y]
step_pin: PB8
dir_pin: PB7
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA6
position_endstop: 200
position_max: 200
position_min:-30
homing_speed: 50

[stepper_z]
step_pin: PB6
dir_pin: PB5
enable_pin: !PC3
microsteps: 16
rotation_distance: 4
endstop_pin: probe: z_virtual_endstop
position_max: 250
position_min:-2

[input_shaper]
shaper_freq_x: 63.4
shaper_type_x: ei
shaper_freq_y: 52.0
shaper_type_y: mzv

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 4.637
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: EBBCan: PA3
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_temp: 0
max_temp: 300
sensor_type: MAX31865
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2

[heater_bed]
heater_pin: PA2
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
control: pid
pid_kp: 66.429
pid_ki: 1.197
pid_kd: 921.707
min_temp: 0
max_temp: 135

[fan]
pin: multi_pin: my_fans

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 600
max_accel: 5000
max_z_velocity: 5
max_z_accel: 100

[display]
lcd_type: st7920
cs_pin: PB12
sclk_pin: PB13
sid_pin: PB15
encoder_pins: ^PB14, ^PB10
click_pin: ^!PB2

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 37.814
#*# pid_ki = 10.084
#*# pid_kd = 35.451
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 17
#*# calibrate =
#*# 	0.050000:3234875.539,0.090000:3233816.865,0.130000:3232741.494,
#*# 	0.170000:3231714.216,0.210000:3230681.306,0.250000:3229632.288,
#*# 	0.290000:3228607.886,0.330000:3227609.723,0.370000:3226599.120,
#*# 	0.410000:3225606.659,0.450000:3224647.275,0.490000:3223715.644,
#*# 	0.530000:3222812.065,0.570000:3221860.807,0.610000:3220949.527,
#*# 	0.650000:3220061.753,0.690000:3219191.031,0.730000:3218333.403,
#*# 	0.770000:3217506.159,0.810000:3216635.626,0.850000:3215799.510,
#*# 	0.890000:3214975.575,0.930000:3214188.051,0.970000:3213396.653,
#*# 	1.010000:3212609.852,1.050000:3211842.222,1.090000:3211071.964,
#*# 	1.130000:3210323.971,1.170000:3209595.457,1.210000:3208877.158,
#*# 	1.250000:3208156.203,1.290000:3207475.057,1.330000:3206828.722,
#*# 	1.370000:3206135.085,1.410000:3205476.723,1.450000:3204847.904,
#*# 	1.490000:3204218.801,1.530000:3203622.648,1.570000:3203042.965,
#*# 	1.610000:3202457.394,1.650000:3201859.971,1.690000:3201306.960,
#*# 	1.730000:3200741.395,1.770000:3200201.746,1.810000:3199652.476,
#*# 	1.850000:3199115.634,1.890000:3198606.779,1.930000:3198092.728,
#*# 	1.970000:3197580.639,2.010000:3197093.371,2.050000:3196585.558,
#*# 	2.090000:3196132.663,2.130000:3195666.829,2.170000:3195226.535,
#*# 	2.210000:3194771.711,2.250000:3194344.143,2.290000:3193915.733,
#*# 	2.330000:3193482.751,2.370000:3193084.016,2.410000:3192654.726,
#*# 	2.450000:3192234.340,2.490000:3191853.450,2.530000:3191484.518,
#*# 	2.570000:3191094.737,2.610000:3190721.090,2.650000:3190361.448,
#*# 	2.690000:3189993.623,2.730000:3189652.696,2.770000:3189275.058,
#*# 	2.810000:3188961.910,2.850000:3188628.750,2.890000:3188285.520,
#*# 	2.930000:3187963.001,2.970000:3187651.239,3.010000:3187332.995,
#*# 	3.050000:3187033.409,3.090000:3186728.006,3.130000:3186440.179,
#*# 	3.170000:3186132.910,3.210000:3185853.685,3.250000:3185576.324,
#*# 	3.290000:3185291.436,3.330000:3185047.066,3.370000:3184762.348,
#*# 	3.410000:3184534.285,3.450000:3184248.893,3.490000:3183993.022,
#*# 	3.530000:3183745.971,3.570000:3183488.982,3.610000:3183219.806,
#*# 	3.650000:3183000.714,3.690000:3182764.179,3.730000:3182519.295,
#*# 	3.770000:3182305.017,3.810000:3182088.569,3.850000:3181862.841,
#*# 	3.890000:3181635.450,3.930000:3181432.080,3.970000:3181219.581,
#*# 	4.010000:3181016.434,4.050000:3180797.834
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 34.799302
