# This file contains pin mappings for the stock 2020 Creality Ender 5
# Pro with the 32-bit Creality 4.2.2 board. To use this config, during
# "make menuconfig" select the STM32F103 with a "28KiB bootloader" and
# with "Use USB for communication" disabled.

# If you prefer a direct serial connection, in "make menuconfig"
# select "Enable extra low-level configuration options" and select the
# USART3 serial port, which is broken out on the 10 pin IDC cable used
# for the LCD module as follows:
# 3: Tx, 4: Rx, 9: GND, 10: VCC

# Flash this firmware by copying "out/klipper.bin" to a SD card and
# turning on the printer with the card inserted. The firmware
# filename must end in ".bin" and must not match the last filename
# that was flashed.

# See docs/Config_Reference.md for a description of parameters.
[include mainsail.cfg]
[include ebbcan.cfg]
[include Orbiter2_SmartSensor.cfg]
[include macro.cfg]
[include eddy.cfg]

[multi_pin my_fans]
pins: EBBCan: PA1 , EBBCan: PA0

[stepper_x]
step_pin: PC2
dir_pin: PB9
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA5
position_endstop: 220
position_max: 220
position_min: 0
homing_speed: 50

[stepper_y]
step_pin: PB8
dir_pin: PB7
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA6
position_endstop: 200
position_max: 200
position_min:-30
homing_speed: 50

[stepper_z]
step_pin: PB6
dir_pin: PB5
enable_pin: !PC3
microsteps: 16
rotation_distance: 4
endstop_pin: probe: z_virtual_endstop
position_max: 250
#position_endstop: 0.0

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 4.637
nozzle_diameter: 0.600
filament_diameter: 1.750
heater_pin: EBBCan: PB13
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: EBBCan: PA3
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_temp: 0
max_temp: 300
sensor_type: MAX31865
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2

[heater_bed]
heater_pin: PA2
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
control: pid
pid_kp: 66.429
pid_ki: 1.197
pid_kd: 921.707
min_temp: 0
max_temp: 135

[fan]
pin: multi_pin: my_fans

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

[display]
lcd_type: st7920
cs_pin: PB12
sclk_pin: PB13
sid_pin: PB15
encoder_pins: ^PB14, ^PB10
click_pin: ^!PB2

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 37.814
#*# pid_ki = 10.084
#*# pid_kd = 35.451
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 17
#*# calibrate =
#*# 	0.050000:3236032.679,0.090000:3235602.003,0.130000:3234483.218,
#*# 	0.170000:3233422.819,0.210000:3232334.374,0.250000:3231251.836,
#*# 	0.290000:3230203.826,0.330000:3229167.441,0.370000:3228183.780,
#*# 	0.410000:3227182.984,0.450000:3226211.911,0.490000:3225278.936,
#*# 	0.530000:3224310.849,0.570000:3223365.106,0.610000:3222438.106,
#*# 	0.650000:3221509.395,0.690000:3220628.113,0.730000:3219737.979,
#*# 	0.770000:3218922.558,0.810000:3218052.932,0.850000:3217206.313,
#*# 	0.890000:3216408.605,0.930000:3215523.394,0.970000:3214755.204,
#*# 	1.010000:3213948.208,1.050000:3213188.685,1.090000:3212394.604,
#*# 	1.130000:3211624.458,1.170000:3210857.324,1.210000:3210130.438,
#*# 	1.250000:3209410.588,1.290000:3208691.534,1.330000:3207981.793,
#*# 	1.370000:3207326.562,1.410000:3206647.169,1.450000:3206001.320,
#*# 	1.490000:3205331.119,1.530000:3204726.536,1.570000:3204082.834,
#*# 	1.610000:3203452.025,1.650000:3202838.620,1.690000:3202254.636,
#*# 	1.730000:3201685.326,1.770000:3201113.713,1.810000:3200559.980,
#*# 	1.850000:3199989.504,1.890000:3199440.678,1.930000:3198908.236,
#*# 	1.970000:3198413.763,2.010000:3197911.668,2.050000:3197410.726,
#*# 	2.090000:3196927.500,2.130000:3196433.188,2.170000:3195960.270,
#*# 	2.210000:3195510.330,2.250000:3195037.939,2.290000:3194590.654,
#*# 	2.330000:3194147.067,2.370000:3193735.932,2.410000:3193314.375,
#*# 	2.450000:3192911.283,2.490000:3192473.699,2.530000:3192103.091,
#*# 	2.570000:3191688.226,2.610000:3191331.847,2.650000:3190939.452,
#*# 	2.690000:3190590.043,2.730000:3190176.291,2.770000:3189817.981,
#*# 	2.810000:3189458.215,2.850000:3189117.885,2.890000:3188786.554,
#*# 	2.930000:3188458.987,2.970000:3188129.013,3.010000:3187808.318,
#*# 	3.050000:3187492.157,3.090000:3187186.999,3.130000:3186868.085,
#*# 	3.170000:3186562.881,3.210000:3186284.355,3.250000:3185975.264,
#*# 	3.290000:3185691.599,3.330000:3185387.410,3.370000:3185115.328,
#*# 	3.410000:3184821.800,3.450000:3184562.699,3.490000:3184287.384,
#*# 	3.530000:3184028.711,3.570000:3183746.897,3.610000:3183515.995,
#*# 	3.650000:3183244.275,3.690000:3183031.649,3.730000:3182802.017,
#*# 	3.770000:3182517.471,3.810000:3182335.641,3.850000:3182122.961,
#*# 	3.890000:3181879.794,3.930000:3181663.398,3.970000:3181430.325,
#*# 	4.010000:3181237.476,4.050000:3181021.592
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 34.937440
