# This file contains pin mappings for the stock 2020 Creality Ender 5
# Pro with the 32-bit Creality 4.2.2 board. To use this config, during
# "make menuconfig" select the STM32F103 with a "28KiB bootloader" and
# with "Use USB for communication" disabled.

# If you prefer a direct serial connection, in "make menuconfig"
# select "Enable extra low-level configuration options" and select the
# USART3 serial port, which is broken out on the 10 pin IDC cable used
# for the LCD module as follows:
# 3: Tx, 4: Rx, 9: GND, 10: VCC

# Flash this firmware by copying "out/klipper.bin" to a SD card and
# turning on the printer with the card inserted. The firmware
# filename must end in ".bin" and must not match the last filename
# that was flashed.

# See docs/Config_Reference.md for a description of parameters.
[include mainsail.cfg]
[include ebbcan.cfg]
[include Orbiter2_SmartSensor.cfg]
[include macro.cfg]
[include eddy.cfg]

[multi_pin my_fans]
pins: EBBCan: PA1 , EBBCan: PA0

[stepper_x]
step_pin: PC2
dir_pin: PB9
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA5
position_endstop: 220
position_max: 220
position_min: 0
homing_speed: 50

[stepper_y]
step_pin: PB8
dir_pin: PB7
enable_pin: !PC3
microsteps: 16
rotation_distance: 40
endstop_pin: ^PA6
position_endstop: 200
position_max: 200
position_min:-30
homing_speed: 50

[stepper_z]
step_pin: PB6
dir_pin: PB5
enable_pin: !PC3
microsteps: 16
rotation_distance: 4
endstop_pin: probe: z_virtual_endstop
position_max: 250
#position_endstop: 0.0

[extruder]
step_pin: EBBCan: PD0
dir_pin: EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
rotation_distance: 4.637
nozzle_diameter: 0.600
filament_diameter: 1.750
heater_pin: EBBCan: PB13
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: EBBCan: PA3
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
full_steps_per_rotation: 200
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_temp: 0
max_temp: 300
sensor_type: MAX31865
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 100
rtd_reference_r: 430
rtd_num_of_wires: 2

[heater_bed]
heater_pin: PA2
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
control: pid
pid_kp: 66.429
pid_ki: 1.197
pid_kd: 921.707
min_temp: 0
max_temp: 135

[fan]
pin: multi_pin: my_fans

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

[display]
lcd_type: st7920
cs_pin: PB12
sclk_pin: PB13
sid_pin: PB15
encoder_pins: ^PB14, ^PB10
click_pin: ^!PB2

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 37.814
#*# pid_ki = 10.084
#*# pid_kd = 35.451
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 17
#*# calibrate =
#*# 	0.050000:3237032.665,0.090000:3236472.564,0.130000:3235512.353,
#*# 	0.170000:3234602.853,0.210000:3233680.267,0.250000:3232842.965,
#*# 	0.290000:3231987.972,0.330000:3231121.073,0.370000:3230322.012,
#*# 	0.410000:3229484.730,0.450000:3228697.643,0.490000:3227899.203,
#*# 	0.530000:3227135.671,0.570000:3226401.540,0.610000:3225679.001,
#*# 	0.650000:3224931.380,0.690000:3224216.141,0.730000:3223510.818,
#*# 	0.770000:3222836.586,0.810000:3222202.136,0.850000:3221525.842,
#*# 	0.890000:3220910.273,0.930000:3220266.981,0.970000:3219638.336,
#*# 	1.010000:3219017.833,1.050000:3218424.544,1.090000:3217837.699,
#*# 	1.130000:3217255.025,1.170000:3216710.236,1.210000:3216101.953,
#*# 	1.250000:3215547.435,1.290000:3214950.353,1.330000:3214395.381,
#*# 	1.370000:3213885.646,1.410000:3213364.180,1.450000:3212831.382,
#*# 	1.490000:3212334.271,1.530000:3211849.902,1.570000:3211354.305,
#*# 	1.610000:3210880.192,1.650000:3210403.819,1.690000:3209933.506,
#*# 	1.730000:3209467.414,1.770000:3209015.322,1.810000:3208592.144,
#*# 	1.850000:3208159.819,1.890000:3207745.654,1.930000:3207318.470,
#*# 	1.970000:3206921.493,2.010000:3206493.048,2.050000:3206106.439,
#*# 	2.090000:3205687.076,2.130000:3205312.350,2.170000:3204912.470,
#*# 	2.210000:3204526.082,2.250000:3204170.285,2.290000:3203799.499,
#*# 	2.330000:3203435.014,2.370000:3203106.579,2.410000:3202765.045,
#*# 	2.450000:3202413.207,2.490000:3202072.130,2.530000:3201756.361,
#*# 	2.570000:3201416.524,2.610000:3201137.983,2.650000:3200795.853,
#*# 	2.690000:3200507.108,2.730000:3200197.150,2.770000:3199859.925,
#*# 	2.810000:3199556.807,2.850000:3199269.759,2.890000:3198986.124,
#*# 	2.930000:3198712.050,2.970000:3198423.391,3.010000:3198157.359,
#*# 	3.050000:3197867.364,3.090000:3197626.097,3.130000:3197363.475,
#*# 	3.170000:3197120.066,3.210000:3196862.909,3.250000:3196636.489,
#*# 	3.290000:3196375.799,3.330000:3196145.770,3.370000:3195917.410,
#*# 	3.410000:3195685.848,3.450000:3195461.657,3.490000:3195231.959,
#*# 	3.530000:3195016.968,3.570000:3194817.267,3.610000:3194601.665,
#*# 	3.650000:3194382.556,3.690000:3194199.394,3.730000:3193991.488,
#*# 	3.770000:3193794.258,3.810000:3193585.730,3.850000:3193411.488,
#*# 	3.890000:3193217.661,3.930000:3193045.455,3.970000:3192863.919,
#*# 	4.010000:3192666.512,4.050000:3192533.300
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 34.635678
